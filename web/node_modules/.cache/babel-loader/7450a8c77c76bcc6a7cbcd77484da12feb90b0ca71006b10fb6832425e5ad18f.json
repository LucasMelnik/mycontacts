{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useEffect, createRef, useCallback, useRef, useState } from 'react';\nexport default function useAnimatedList() {\n  _s();\n  let initialValue = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  const [items, setItems] = useState(initialValue);\n  const [pendingRemovalItemsIds, setPendingRemovalItemsIds] = useState([]);\n  const animatedRefs = useRef(new Map());\n  const animationEndLIsteners = useRef(new Map());\n  const handleAnimationEnd = useCallback(itemId => {\n    const removeListener = animationEndLIsteners.current.get(itemId);\n    removeListener();\n    animatedRefs.current.delete(itemId);\n    animationEndLIsteners.current.delete(itemId);\n    setItems(prevState => prevState.filter(item => item.id !== itemId));\n    setPendingRemovalItemsIds(prevState => prevState.filter(id => itemId !== id));\n  }, []);\n  useEffect(() => {\n    pendingRemovalItemsIds.forEach(itemId => {\n      const animatedRef = animatedRefs.current.get(itemId);\n      const animatedElement = animatedRef === null || animatedRef === void 0 ? void 0 : animatedRef.current;\n      const alreadyHasListener = animationEndLIsteners.current.has(itemId);\n      if (animatedElement && !alreadyHasListener) {\n        const onAnimationEnd = () => handleAnimationEnd(itemId);\n        const removeListener = () => {\n          animatedElement.removeEventListener('animationend', onAnimationEnd);\n        };\n        animatedElement.addEventListener('animationend', onAnimationEnd);\n        animationEndLIsteners.current.set(itemId, removeListener);\n      }\n    });\n  }, [pendingRemovalItemsIds, handleAnimationEnd]);\n  useEffect(() => {\n    const removeListeners = animationEndLIsteners.current;\n    return () => {\n      removeListeners.forEach(removeListener => removeListener());\n    };\n  }, []);\n  const handleRemoveItem = useCallback(id => {\n    setPendingRemovalItemsIds(prevState => [...prevState, id]);\n  }, []);\n  const getAnimatedRef = useCallback(itemId => {\n    let animatedRef = animatedRefs.current.get(itemId);\n    if (!animatedRef) {\n      animatedRef = /*#__PURE__*/createRef();\n      animatedRefs.current.set(itemId, animatedRef);\n    }\n    return animatedRef;\n  }, []);\n  const renderList = useCallback(renderItem => items.map(item => {\n    const isLeaving = pendingRemovalItemsIds.includes(item.id);\n    const animatedRef = getAnimatedRef(item.id);\n    return renderItem(item, {\n      isLeaving,\n      animatedRef\n    });\n  }), [items, pendingRemovalItemsIds, getAnimatedRef]);\n  return {\n    items,\n    setItems,\n    handleRemoveItem,\n    renderList\n  };\n}\n_s(useAnimatedList, \"SrQzrpVNn2EWfhfFel7NArtd2Cc=\");","map":{"version":3,"names":["useEffect","createRef","useCallback","useRef","useState","useAnimatedList","_s","initialValue","arguments","length","undefined","items","setItems","pendingRemovalItemsIds","setPendingRemovalItemsIds","animatedRefs","Map","animationEndLIsteners","handleAnimationEnd","itemId","removeListener","current","get","delete","prevState","filter","item","id","forEach","animatedRef","animatedElement","alreadyHasListener","has","onAnimationEnd","removeEventListener","addEventListener","set","removeListeners","handleRemoveItem","getAnimatedRef","renderList","renderItem","map","isLeaving","includes"],"sources":["/home/melnik/dev/jstack/mycontacts/web/src/hooks/useAnimatedList.js"],"sourcesContent":["import {\n  useEffect,\n  createRef, useCallback, useRef, useState,\n} from 'react';\n\nexport default function useAnimatedList(initialValue = []) {\n  const [items, setItems] = useState(initialValue);\n  const [pendingRemovalItemsIds, setPendingRemovalItemsIds] = useState([]);\n\n  const animatedRefs = useRef(new Map());\n  const animationEndLIsteners = useRef(new Map());\n\n  const handleAnimationEnd = useCallback((itemId) => {\n    const removeListener = animationEndLIsteners.current.get(itemId);\n    removeListener();\n\n    animatedRefs.current.delete(itemId);\n    animationEndLIsteners.current.delete(itemId);\n\n    setItems((prevState) => prevState.filter((item) => item.id !== itemId));\n    setPendingRemovalItemsIds(\n      (prevState) => prevState.filter((id) => itemId !== id),\n    );\n  }, []);\n\n  useEffect(() => {\n    pendingRemovalItemsIds.forEach((itemId) => {\n      const animatedRef = animatedRefs.current.get(itemId);\n      const animatedElement = animatedRef?.current;\n      const alreadyHasListener = animationEndLIsteners.current.has(itemId);\n\n      if (animatedElement && !alreadyHasListener) {\n        const onAnimationEnd = () => handleAnimationEnd(itemId);\n        const removeListener = () => {\n          animatedElement.removeEventListener('animationend', onAnimationEnd);\n        };\n\n        animatedElement.addEventListener('animationend', onAnimationEnd);\n        animationEndLIsteners.current.set(itemId, removeListener);\n      }\n    });\n  }, [pendingRemovalItemsIds, handleAnimationEnd]);\n\n  useEffect(() => {\n    const removeListeners = animationEndLIsteners.current;\n    return () => {\n      removeListeners.forEach((removeListener) => removeListener());\n    };\n  }, []);\n\n  const handleRemoveItem = useCallback((id) => {\n    setPendingRemovalItemsIds(\n      (prevState) => [...prevState, id],\n    );\n  }, []);\n\n  const getAnimatedRef = useCallback((itemId) => {\n    let animatedRef = animatedRefs.current.get(itemId);\n\n    if (!animatedRef) {\n      animatedRef = createRef();\n      animatedRefs.current.set(itemId, animatedRef);\n    }\n\n    return animatedRef;\n  }, []);\n\n  const renderList = useCallback((renderItem) => (\n    items.map((item) => {\n      const isLeaving = pendingRemovalItemsIds.includes(item.id);\n      const animatedRef = getAnimatedRef(item.id);\n\n      return renderItem(item, { isLeaving, animatedRef });\n    })\n  ), [items, pendingRemovalItemsIds, getAnimatedRef]);\n\n  return {\n    items,\n    setItems,\n    handleRemoveItem,\n    renderList,\n  };\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}